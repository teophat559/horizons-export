# Netlify configuration for Vite + Functions

[build]
  # Always install deps explicitly to ensure devDependencies (like Vite) are present.
  # Allow per-site build selection via BUILD_SCRIPT env (e.g. build, build:user:nix, build:admin:nix).
  # If BUILD_SCRIPT is unset, default to "build".
  command = "npm ci && if [ -n \"$BUILD_SCRIPT\" ]; then npm run \"$BUILD_SCRIPT\"; else npm run build; fi"
  # Do NOT hardcode publish for multi-site setups; set per-site in Netlify UI.
  # publish = "dist"
  functions = ""

[build.environment]
  # Use a modern Node and make sure devDependencies are installed (no --production)
  NODE_VERSION = "20"
  NPM_FLAGS = ""

[dev]
  command = "npm run dev"          # Start Vite dev server
  targetPort = 5173                 # Vite dev server port
  port = 8888                       # Netlify Dev proxy port
  framework = "vite"
  functions = "netlify/functions"

[functions]
  node_bundler = "esbuild"         # Better ESM support

# Do not define SPA fallback here; we use public/_redirects for redirects and headers.
